# 배치 성공보다 중요한 것: **신뢰할 수 있는 KPI**

대시보드 숫자가 흔들릴 때, 문제는 캠페인 성과가 아니라 **지표 정의**일 수 있습니다.  
이 프로젝트는 RetailRocket clickstream을 기반으로 퍼널·코호트·CRM 타겟을 산출하되, 핵심 목표를 “집계”가 아닌 **재현 가능한 의사결정 데이터**에 둡니다.

> 같은 로그를 다시 돌렸을 때, 같은 KPI가 나와야 합니다.

---

## 왜 이 파이프라인을 만들었나

현업에서 KPI 해석이 흔들리는 순간은 생각보다 단순합니다.

- 세션 기준이 팀마다 다르다.
- 전환 이벤트 정의가 배포 중 바뀌었다.
- `transaction_id` 누락이 조용히 늘었다.

배치는 성공해도, 지표는 신뢰를 잃을 수 있습니다.  
그래서 이 파이프라인은 Airflow 성공 여부 이전에, **“이 숫자를 의사결정에 써도 되는가”**를 먼저 검증하도록 설계했습니다.

---

## 무엇을 제공하나

### 산출물

- 퍼널(Funnel) KPI
- 코호트(Cohort) KPI
- CRM 타겟 데이터
- 운영 전달용 고정 포맷: CSV 3종 + Summary TXT 1종

### 품질 게이트

실행 완료보다 **품질 통과**를 우선합니다.

- domain 검증
- integrity 검증
- null 검증
- rowcount 검증
- KPI range 검증(0~1)

---

## 처리 흐름 한눈에 보기

![Pipeline Architecture](assets/pipeline_architecture.svg)

1. **RAW** — 원본 보존으로 추적 가능성 확보
2. **STAGING** — 타입/포맷 표준화로 전처리 편차 제거
3. **DATA MART** — 세션화와 분석 grain 정렬
4. **KPI** — 퍼널·코호트·CRM 계산 책임 분리
5. **QA** — 기준 미달 시 후속 단계 차단
6. **EXPORT** — 운영팀이 바로 쓰는 고정 산출물 생성

---

## 실행 근거(Proof)

### 1) 재현 가능한 실행

대표 검증 실행은 `target_date=2015-06-16` 수동 백필(run)입니다.

![Airflow run success](assets/airflow_run_success.png)

### 2) 결과물 일관성

동일 규격의 산출물(CSV 3 + TXT 1)을 남겨, 날짜 단위 재계산과 비교 검증이 가능합니다.

![Outputs 2015-06-16](assets/outputs_2015-06-16.png)

---

## 실무에서 어떤 의미가 있나

- **분석/그로스 팀**: KPI 급락 시, 캠페인 조정 전에 정의·세션·누락 이슈를 먼저 점검할 수 있습니다.
- **데이터 운영 팀**: 배치 성공과 지표 신뢰를 분리해, 품질 기준 중심으로 운영할 수 있습니다.

결국 이 문서와 파이프라인의 목적은 하나입니다.  
**“숫자를 만드는 것”이 아니라 “숫자를 믿을 수 있게 만드는 것.”**

---

## 다음 확장 포인트

- Slack 기반 실패/품질 알림
- 품질 추세 대시보드
- dbt/Great Expectations 연계 테스트

---

## 바로가기

- [Metrics](metrics.md)
- [Runbook](runbook.md)
- [Source Code](../../)
