<svg width="1800" height="760" viewBox="0 0 1800 760" fill="none" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: 700 36px "Inter", "Pretendard", "Noto Sans KR", Arial, sans-serif; fill: #0f172a; }
      .label { font: 700 32px "Inter", "Pretendard", "Noto Sans KR", Arial, sans-serif; fill: #0f172a; }
      .sub { font: 550 20px "Inter", "Pretendard", "Noto Sans KR", Arial, sans-serif; fill: #334155; }
      .noteHead { font: 700 28px "Inter", "Pretendard", "Noto Sans KR", Arial, sans-serif; fill: #0f172a; }
      .noteLine { font: 500 20px "Inter", "Pretendard", "Noto Sans KR", Arial, sans-serif; fill: #334155; }
      .footer { font: 500 18px "Inter", "Pretendard", "Noto Sans KR", Arial, sans-serif; fill: #475569; }
    </style>
    <marker id="arrow" markerWidth="14" markerHeight="14" refX="12" refY="7" orient="auto">
      <path d="M0,0 L14,7 L0,14 z" fill="#64748b"/>
    </marker>
  </defs>

  <rect x="0" y="0" width="1800" height="760" fill="#f8fafc"/>
  <text x="900" y="62" text-anchor="middle" class="title">Airflow RetailRocket Pipeline Architecture (RAW → EXPORT)</text>

  <!-- Layer boxes -->
  <g>
    <rect x="40" y="140" rx="16" ry="16" width="240" height="180" fill="#dbeafe" stroke="#334155" stroke-width="2.5"/>
    <text x="160" y="200" text-anchor="middle" class="label">RAW</text>
    <text x="160" y="236" text-anchor="middle" class="sub">events/category</text>
    <text x="160" y="265" text-anchor="middle" class="sub">item properties</text>
  </g>

  <g>
    <rect x="330" y="140" rx="16" ry="16" width="240" height="180" fill="#dcfce7" stroke="#334155" stroke-width="2.5"/>
    <text x="450" y="200" text-anchor="middle" class="label">STAGING</text>
    <text x="450" y="236" text-anchor="middle" class="sub">normalize &amp; cast</text>
    <text x="450" y="265" text-anchor="middle" class="sub">snapshot/category tree</text>
  </g>

  <g>
    <rect x="620" y="140" rx="16" ry="16" width="240" height="180" fill="#fef3c7" stroke="#334155" stroke-width="2.5"/>
    <text x="740" y="200" text-anchor="middle" class="label">MART</text>
    <text x="740" y="236" text-anchor="middle" class="sub">dim/fact modeling</text>
    <text x="740" y="265" text-anchor="middle" class="sub">sessionization</text>
  </g>

  <g>
    <rect x="910" y="140" rx="16" ry="16" width="240" height="180" fill="#fee2e2" stroke="#334155" stroke-width="2.5"/>
    <text x="1030" y="200" text-anchor="middle" class="label">KPI</text>
    <text x="1030" y="236" text-anchor="middle" class="sub">funnel/cohort</text>
    <text x="1030" y="265" text-anchor="middle" class="sub">CRM targets</text>
  </g>

  <g>
    <rect x="1200" y="140" rx="16" ry="16" width="240" height="180" fill="#e9d5ff" stroke="#334155" stroke-width="2.5"/>
    <text x="1320" y="200" text-anchor="middle" class="label">QA</text>
    <text x="1320" y="236" text-anchor="middle" class="sub">domain/null/integrity</text>
    <text x="1320" y="265" text-anchor="middle" class="sub">sanity checks</text>
  </g>

  <g>
    <rect x="1490" y="140" rx="16" ry="16" width="240" height="180" fill="#ccfbf1" stroke="#334155" stroke-width="2.5"/>
    <text x="1610" y="200" text-anchor="middle" class="label">EXPORT</text>
    <text x="1610" y="236" text-anchor="middle" class="sub">CSV reports</text>
    <text x="1610" y="265" text-anchor="middle" class="sub">pipeline summary</text>
  </g>

  <!-- Arrows -->
  <line x1="280" y1="230" x2="330" y2="230" stroke="#64748b" stroke-width="4.5" marker-end="url(#arrow)"/>
  <line x1="570" y1="230" x2="620" y2="230" stroke="#64748b" stroke-width="4.5" marker-end="url(#arrow)"/>
  <line x1="860" y1="230" x2="910" y2="230" stroke="#64748b" stroke-width="4.5" marker-end="url(#arrow)"/>
  <line x1="1150" y1="230" x2="1200" y2="230" stroke="#64748b" stroke-width="4.5" marker-end="url(#arrow)"/>
  <line x1="1440" y1="230" x2="1490" y2="230" stroke="#64748b" stroke-width="4.5" marker-end="url(#arrow)"/>

  <!-- MART detail panel -->
  <rect x="120" y="380" rx="18" ry="18" width="1560" height="280" fill="#ffffff" stroke="#cbd5e1" stroke-width="2.5"/>
  <text x="160" y="430" class="noteHead">MART Detail</text>

  <text x="160" y="470" class="noteLine">• Dimensions: dim_rr_category, dim_rr_item, dim_rr_visitor</text>
  <text x="160" y="505" class="noteLine">• Facts: fact_rr_events (session_id 부여), fact_rr_sessions (views/carts/purchases + flags)</text>
  <text x="160" y="540" class="noteLine">• Sessionization Rule: 첫 이벤트 OR 날짜 변경 OR 이전 이벤트 대비 30분 초과 inactivity</text>
  <text x="160" y="575" class="noteLine">• Session ID: visitor_id-session_index</text>

  <text x="900" y="714" text-anchor="middle" class="footer">
    Outputs: rr_funnel_daily.csv / rr_cohort_weekly.csv / rr_crm_targets.csv / rr_pipeline_summary.txt
  </text>
</svg>

